<table class="table table-striped">
  <tbody>
   <tr>
     <th><?=$this->transEsc('keywordchains')?></th><th><?=$this->transEsc("sort_keywordchain_relevance")?></th>
     <th><?=$this->transEsc('keywordchains_terms')?></th>
   </tr>
   <? if(!empty($this->results)):?>
   <?   $r = $this->results->getResults()?>
   <?	if(!empty($r)):?>
   <?     foreach ($this->results->getResults() as $current):?>
   <tr>
      <td>
	   <? 
              // Sort KWC alphabetically
              $kwc = explode('/', $current['value']);
              sort($kwc, SORT_STRING);
	      $kwc_sorted = implode('/', $kwc);

	   ?>
	   <a href="<?=$this->url('search-results')?>?lookfor=<?=urlencode('"' . $kwc_sorted . '"')?>&type=Keywordchains">
		<?=$this->escapeHtml(implode(' / ', explode('/', $current['value'])))?>
	   </a>
      </td>
      <td><?=$this->escapeHtml($current['count'])?></td>
      <td>
      <?    foreach(explode('/', $current['value']) as $term):?>
              <a href="<?=$this->url('keywordchainsearch-results')?>?lookfor=<?=urlencode('"' . $term . '"')?>">
	       <span class="kwc_single_term" style="background-color: #d9d9d9; padding:3px;"><?=$this->escapeHtml($term)?></span></a>
           <?endforeach;?>
      </td>
   </tr>
   <? endforeach; ?> 
   <? endif; ?>
   <? endif; ?>
  </tbody>
</table>
<script>
  $(document).ready(function(){
    $(".kwc_single_term").bind('click keypress', function(event){
       if(event.shiftKey){
         event.preventDefault();
         var oldformval = $("#kwc_input").val();
	 var newKWC = "\"" + $(this).text() + "\"";
	 if (oldformval.indexOf(newKWC) > -1) {
	    $("#kwc_input").val(oldformval.replace(newKWC, "").replace("  ", " ").trim());
	 } else {
           $("#kwc_input").val(oldformval + " " + newKWC);
	 }
       }
    });
    $("*").bind('keypress', function(event){
      if(event.shiftKey && event.which === 8){
        $("#kwc_input").val("");
       }
    });
  });
</script>


